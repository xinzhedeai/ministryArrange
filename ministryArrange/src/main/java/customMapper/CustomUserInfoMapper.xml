<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="customMapper.CustomUserInfoMapper">
	<select id="checkUser" resultType="Integer">
		select 
			count(user_name)
		from
			user
	    where 
	    	user_name = #{userName} and user_pwd = #{userPwd};
	</select>
	<insert id="insertUser">
		insert into user
		(
		<!-- id, -->
		username,
		pwd,
		tel,
		area,
		church,
		serve_days_pre_forth,
		serve_days_fifth
		)
		values
		(
		<!-- UUID(), -->
		#{username},
		UUID(),
		#{tel},
		#{area},
		#{church},
		#{serve_days_pre_forth},
		#{serve_days_fifth}
		)
	</insert>
	<insert id="insertAddress">
		insert into serviceaddress
		(
		<!-- id, -->
		area,
		church,
		reunion_type
		)
		values
		(
		<!-- UUID(), -->
		#{area},
		#{church},
		#{reunion_type}
		)
	</insert>
	<select id="getUserListByPage"  parameterType="Map" resultType="Map">
		SELECT
			id
			,username
			,pwd
			,tel
			,area
			,church
			,longitude
			,latitude
			,serve_days_pre_forth * 1 as serve_days_pre_forth
			,serve_days_fifth * 1 as serve_days_fifth			
		FROM
			user 
   		<where>
		 	<if test="area != null and area != ''">
			 	and area like '%${area}%'
		 	</if>
		 	<if test="church != null and church != ''">
			 	and church like '%${church}%'
		 	</if>
		 	<if test="serve_days_pre_forth != null and serve_days_pre_forth != ''">
			 	and serve_days_pre_forth = #{serve_days_pre_forth}
		 	</if>
		 	<if test="serve_days_fifth != null and serve_days_fifth != ''">
			 	and serve_days_fifth like  = #{serve_days_fifth}
		 	</if>
	 	</where>	
	 </select>
	 
 	<select id="getAddrListByPage"  parameterType="Map" resultType="Map">
		SELECT
			id
			,area
			,church
			, case reunion_type WHEN '0' THEN '星期四'
			WHEN '1' THEN '星期六'
			ELSE '星期日'
			END AS reunion_type
		FROM
			serviceaddress 
   		<where>
		 	<if test="area != null and area != ''">
			 	and area like '%${area}%'
		 	</if>
		 	<if test="church != null and church != ''">
			 	and church like '%${church}%'
		 	</if>
	 	</where>	
	 </select>
	 <select id="getAddrByType"  parameterType="Map" resultType="Map">
		SELECT
			area
			,church
			, case reunion_type WHEN '0' THEN '星期四'
			WHEN '1' THEN '星期六'
			ELSE '星期日'
			END AS reunion_type
		FROM
			serviceaddress 
	 </select>
 	<insert id="insertAddrDate" parameterType="Map">
		insert into servicearrange
		<trim prefix="(" suffix=")" suffixOverrides=",">
			area,
			church,
			reuniondate,
			reuniondateCN,
			weekofdate
		</trim>   
		 <foreach collection="list" item="item" index="index" open="VALUES" close=";" separator=",">
	  		<trim prefix="(" suffix=")" suffixOverrides=",">
		   		#{item.area},
		   		#{item.church},
		   		#{item.reunion_date},
		   		#{item.reunion_dateCN},
		   		#{item.weekofdate}
		   </trim>
		</foreach>
	</insert>
	 <select id="getServiceList"  parameterType="Map" resultType="Map">
		SELECT
			id
			,area
			,church
			,user_id
			,reuniondate
			,reuniondateCN
			,arrangestatus
			,weekofdate
		FROM
			servicearrange 
	 </select>
	 <select id="getAddrRelDateList"  parameterType="String" resultType="Map">
		SELECT
			id
			,area
			,church
			,user_id
			,reuniondate
			,reuniondateCN
			,arrangestatus
			,weekofdate
		FROM
			servicearrange
		where 1 = 1 
			<if test="_parameter != null and _parameter != '' and _parameter = 'forth'">
			 	and weekofdate != 5
		 	</if>
	 </select>
	  <select id="getServiceUsers"  parameterType="String" resultType="Map">
		SELECT
			id
			,username
			,pwd
			,tel
			,area
			,church
			,longitude
			,latitude
			,serve_days_pre_forth * 1 as serve_days_pre_forth
			,serve_days_fifth * 1 as serve_days_fifth			
		FROM
			user 
		where 1 = 1
			<if test="_parameter != null and _parameter != '' and _parameter = 'forth'">
			 	and serve_days_pre_forth is not null
		 	</if>
		 	<if test="_parameter != null and _parameter != '' and _parameter = 'fifth'">
			 	and serve_days_fifth is not null
		 	</if>
	 </select>
	 
	 
     <update id="serviceArrange" parameterType="Map">
   		 
        <foreach collection="list" item="item" index="index" open="" close="" separator=";">   
           	update servicearrange set     
            	user_id = #{item.user_id},    
       	 	WHERE 
       	 		id = #{item.id}    
        </foreach>  
    </update>
</mapper>